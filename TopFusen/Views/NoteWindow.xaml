<Window x:Class="TopFusen.Views.NoteWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        WindowStyle="None"
        AllowsTransparency="True"
        Topmost="True"
        ShowInTaskbar="False"
        MinWidth="160"
        MinHeight="120"
        Width="240"
        Height="180"
        Background="Transparent">

    <!-- P3-1: WindowChrome â€” ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«æœ‰åŠ¹åŒ– + CaptionHeight=0ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ©ãƒƒã‚°ï¼‰ -->
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0"
                      ResizeBorderThickness="6"
                      GlassFrameThickness="0"
                      CornerRadius="0"/>
    </WindowChrome.WindowChrome>

    <!-- ä»˜ç®‹ã®æœ¬ä½“ï¼ˆBorderThickness ã¯å¸¸ã« 2ã€é¸æŠžæ™‚ã®ã¿è‰²ãŒä»˜ãï¼‰ -->
    <Border x:Name="NoteBorder"
            Background="#FFFBE38C"
            CornerRadius="4"
            BorderThickness="2"
            BorderBrush="Transparent">

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ï¼ˆãƒ‰ãƒ©ãƒƒã‚°é ˜åŸŸï¼‰ -->
                <RowDefinition Height="*"/>     <!-- æœ¬æ–‡ -->
                <RowDefinition Height="Auto"/>  <!-- ä¸‹éƒ¨ã‚¢ã‚¤ã‚³ãƒ³åˆ— -->
            </Grid.RowDefinitions>

            <!-- === Phase 4: ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ï¼ˆç·¨é›†ON + é¸æŠžä¸­ã®ã¿è¡¨ç¤º / ãƒ‰ãƒ©ãƒƒã‚° + è£…é£¾ï¼‰ === -->
            <Border x:Name="ToolbarArea"
                    Grid.Row="0"
                    Background="#18000000"
                    Padding="4,2"
                    CornerRadius="2,2,0,0"
                    Cursor="SizeAll"
                    Visibility="Collapsed"
                    MouseLeftButtonDown="ToolbarArea_MouseLeftButtonDown">
                <DockPanel>
                    <!-- ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ«ï¼ˆå·¦ç«¯ï¼‰ -->
                    <TextBlock DockPanel.Dock="Left"
                               Text="â ¿"
                               FontSize="14"
                               Foreground="#66333333"
                               VerticalAlignment="Center"
                               Margin="0,0,4,0"
                               IsHitTestVisible="False"/>

                    <!-- Phase 4: è£…é£¾ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
                    <StackPanel Orientation="Horizontal"
                                VerticalAlignment="Center">
                        <!-- å¤ªå­— B -->
                        <Button x:Name="BoldButton"
                                Width="22" Height="22" Margin="1,0"
                                Focusable="False" Cursor="Hand"
                                Background="Transparent"
                                BorderBrush="#44333333" BorderThickness="1"
                                Click="BoldButton_Click"
                                ToolTip="å¤ªå­— (Ctrl+B)">
                            <TextBlock Text="B" FontWeight="Bold" FontSize="12"
                                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Button>
                        <!-- ä¸‹ç·š U -->
                        <Button x:Name="UnderlineButton"
                                Width="22" Height="22" Margin="1,0"
                                Focusable="False" Cursor="Hand"
                                Background="Transparent"
                                BorderBrush="#44333333" BorderThickness="1"
                                Click="UnderlineButton_Click"
                                ToolTip="ä¸‹ç·š (Ctrl+U)">
                            <TextBlock Text="U" FontSize="12"
                                       HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock.TextDecorations>
                                    <TextDecoration Location="Underline"/>
                                </TextBlock.TextDecorations>
                            </TextBlock>
                        </Button>
                        <!-- å–ã‚Šæ¶ˆã—ç·š S -->
                        <Button x:Name="StrikethroughButton"
                                Width="22" Height="22" Margin="1,0"
                                Focusable="False" Cursor="Hand"
                                Background="Transparent"
                                BorderBrush="#44333333" BorderThickness="1"
                                Click="StrikethroughButton_Click"
                                ToolTip="å–ã‚Šæ¶ˆã—ç·š">
                            <TextBlock Text="S" FontSize="12"
                                       HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock.TextDecorations>
                                    <TextDecoration Location="Strikethrough"/>
                                </TextBlock.TextDecorations>
                            </TextBlock>
                        </Button>
                        <!-- åŒºåˆ‡ã‚Šç·š -->
                        <Rectangle Width="1" Height="16" Fill="#33333333" Margin="3,0"/>
                        <!-- æ–‡å­—ã‚µã‚¤ã‚º -->
                        <ComboBox x:Name="FontSizeCombo"
                                  Width="48" Height="22" Margin="1,0"
                                  IsEditable="False"
                                  FontSize="11"
                                  VerticalContentAlignment="Center"
                                  SelectionChanged="FontSizeCombo_SelectionChanged"
                                  DropDownClosed="FontSizeCombo_DropDownClosed"
                                  ToolTip="æ–‡å­—ã‚µã‚¤ã‚º"/>
                        <!-- åŒºåˆ‡ã‚Šç·š -->
                        <Rectangle Width="1" Height="16" Fill="#33333333" Margin="3,0"/>
                        <!-- æ–‡å­—è‰² -->
                        <Button x:Name="TextColorButton"
                                Width="22" Height="22" Margin="1,0"
                                Focusable="False" Cursor="Hand"
                                Background="Transparent"
                                BorderBrush="#44333333" BorderThickness="1"
                                Click="TextColorButton_Click"
                                ToolTip="æ–‡å­—è‰²">
                            <StackPanel>
                                <TextBlock Text="A" FontWeight="Bold" FontSize="11"
                                           HorizontalAlignment="Center"/>
                                <Rectangle x:Name="TextColorIndicator"
                                           Height="3" Fill="#FF333333"
                                           Margin="2,-2,2,0"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </DockPanel>
            </Border>

            <!-- === æœ¬æ–‡é ˜åŸŸï¼ˆPhase 4: RichTextBoxï¼‰ === -->
            <RichTextBox x:Name="NoteRichTextBox"
                         Grid.Row="1"
                         FontSize="14"
                         FontFamily="Yu Gothic UI"
                         Foreground="#FF333333"
                         Background="Transparent"
                         BorderThickness="0"
                         BorderBrush="Transparent"
                         Padding="6,4"
                         IsReadOnly="True"
                         Focusable="False"
                         IsHitTestVisible="False"
                         AcceptsReturn="True"
                         IsTabStop="False"
                         VerticalScrollBarVisibility="Hidden"
                         HorizontalScrollBarVisibility="Disabled"
                         WindowChrome.IsHitTestVisibleInChrome="True">
                <FlowDocument PagePadding="2"/>
            </RichTextBox>

            <!-- === P3-5/P3-6/P6: ä¸‹éƒ¨ã‚¢ã‚¤ã‚³ãƒ³åˆ—ï¼ˆç·¨é›†ON + é¸æŠžä¸­ã®ã¿è¡¨ç¤ºï¼‰ === -->
            <Border x:Name="BottomBar"
                    Grid.Row="2"
                    Visibility="Collapsed">
                <DockPanel Margin="4,0,4,4">
                    <!-- å³å´: æ“ä½œãƒœã‚¿ãƒ³ï¼ˆè¤‡è£½/å‰Šé™¤ï¼‰ -->
                    <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                        <!-- è¤‡è£½ãƒœã‚¿ãƒ³ -->
                        <Button x:Name="DuplicateButton"
                                ToolTip="è¤‡è£½"
                                Width="26" Height="26"
                                Margin="2,0"
                                Cursor="Hand"
                                Click="DuplicateButton_Click"
                                Background="Transparent"
                                BorderBrush="#44333333"
                                BorderThickness="1">
                            <TextBlock Text="ðŸ“‹" FontSize="13" />
                        </Button>
                        <!-- å‰Šé™¤ãƒœã‚¿ãƒ³ -->
                        <Button x:Name="DeleteButton"
                                ToolTip="å‰Šé™¤"
                                Width="26" Height="26"
                                Margin="2,0"
                                Cursor="Hand"
                                Click="DeleteButton_Click"
                                Background="Transparent"
                                BorderBrush="#44333333"
                                BorderThickness="1">
                            <TextBlock Text="ðŸ—‘" FontSize="13" />
                        </Button>
                    </StackPanel>
                    <!-- å·¦å´: ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®šãƒœã‚¿ãƒ³ï¼ˆPhase 6ï¼‰ -->
                    <StackPanel Orientation="Horizontal">
                        <Button x:Name="StyleButton"
                                ToolTip="ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š"
                                Width="26" Height="26"
                                Margin="2,0"
                                Cursor="Hand"
                                Click="StyleButton_Click"
                                Background="Transparent"
                                BorderBrush="#44333333"
                                BorderThickness="1"
                                Focusable="False">
                            <Grid Width="16" Height="16">
                                <!-- ç¾åœ¨ã®èƒŒæ™¯è‰²ã‚’ç¤ºã™ã‚«ãƒ©ãƒ¼ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ -->
                                <Ellipse x:Name="StyleColorIndicator"
                                         Width="14" Height="14"
                                         Fill="#FFFBE38C"
                                         Stroke="#66333333" StrokeThickness="1"/>
                            </Grid>
                        </Button>
                    </StackPanel>
                </DockPanel>
            </Border>

            <!-- Phase 4: æ–‡å­—è‰²ãƒ‘ãƒ¬ãƒƒãƒˆ Popup -->
            <Popup x:Name="TextColorPopup"
                   PlacementTarget="{Binding ElementName=TextColorButton}"
                   Placement="Bottom"
                   StaysOpen="False"
                   AllowsTransparency="True">
                <Border Background="#FFFAFAFA" BorderBrush="#CCCCCC" BorderThickness="1"
                        CornerRadius="4" Padding="4">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="6" ShadowDepth="2" Opacity="0.2"/>
                    </Border.Effect>
                    <UniformGrid Columns="5" Rows="2">
                        <Button Width="22" Height="22" Margin="1" Background="#333333"
                                Click="TextColorSwatch_Click" Tag="#FF333333"
                                BorderBrush="#AAAAAA" BorderThickness="1" Cursor="Hand" Focusable="False"
                                ToolTip="é»’"/>
                        <Button Width="22" Height="22" Margin="1" Background="#FFFFFF"
                                Click="TextColorSwatch_Click" Tag="#FFFFFFFF"
                                BorderBrush="#AAAAAA" BorderThickness="1" Cursor="Hand" Focusable="False"
                                ToolTip="ç™½"/>
                        <Button Width="22" Height="22" Margin="1" Background="#E53935"
                                Click="TextColorSwatch_Click" Tag="#FFE53935"
                                BorderBrush="#AAAAAA" BorderThickness="1" Cursor="Hand" Focusable="False"
                                ToolTip="èµ¤"/>
                        <Button Width="22" Height="22" Margin="1" Background="#1E88E5"
                                Click="TextColorSwatch_Click" Tag="#FF1E88E5"
                                BorderBrush="#AAAAAA" BorderThickness="1" Cursor="Hand" Focusable="False"
                                ToolTip="é’"/>
                        <Button Width="22" Height="22" Margin="1" Background="#43A047"
                                Click="TextColorSwatch_Click" Tag="#FF43A047"
                                BorderBrush="#AAAAAA" BorderThickness="1" Cursor="Hand" Focusable="False"
                                ToolTip="ç·‘"/>
                        <Button Width="22" Height="22" Margin="1" Background="#FB8C00"
                                Click="TextColorSwatch_Click" Tag="#FFFB8C00"
                                BorderBrush="#AAAAAA" BorderThickness="1" Cursor="Hand" Focusable="False"
                                ToolTip="ã‚ªãƒ¬ãƒ³ã‚¸"/>
                        <Button Width="22" Height="22" Margin="1" Background="#8E24AA"
                                Click="TextColorSwatch_Click" Tag="#FF8E24AA"
                                BorderBrush="#AAAAAA" BorderThickness="1" Cursor="Hand" Focusable="False"
                                ToolTip="ç´«"/>
                        <Button Width="22" Height="22" Margin="1" Background="#EC407A"
                                Click="TextColorSwatch_Click" Tag="#FFEC407A"
                                BorderBrush="#AAAAAA" BorderThickness="1" Cursor="Hand" Focusable="False"
                                ToolTip="ãƒ”ãƒ³ã‚¯"/>
                        <Button Width="22" Height="22" Margin="1" Background="#00ACC1"
                                Click="TextColorSwatch_Click" Tag="#FF00ACC1"
                                BorderBrush="#AAAAAA" BorderThickness="1" Cursor="Hand" Focusable="False"
                                ToolTip="æ°´è‰²"/>
                        <Button Width="22" Height="22" Margin="1" Background="#FDD835"
                                Click="TextColorSwatch_Click" Tag="#FFFDD835"
                                BorderBrush="#AAAAAA" BorderThickness="1" Cursor="Hand" Focusable="False"
                                ToolTip="é»„è‰²"/>
                    </UniformGrid>
                </Border>
            </Popup>

            <!-- Phase 6: ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š Popupï¼ˆèƒŒæ™¯è‰² + ä¸é€æ˜Žåº¦ + ãƒ•ã‚©ãƒ³ãƒˆï¼‰ -->
            <Popup x:Name="StylePopup"
                   PlacementTarget="{Binding ElementName=StyleButton}"
                   Placement="Top"
                   StaysOpen="False"
                   AllowsTransparency="True">
                <Border Background="#FFFAFAFA" BorderBrush="#CCCCCC" BorderThickness="1"
                        CornerRadius="6" Padding="8" MinWidth="210">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.2"/>
                    </Border.Effect>
                    <StackPanel>
                        <!-- === èƒŒæ™¯è‰²ã‚»ã‚¯ã‚·ãƒ§ãƒ³ === -->
                        <TextBlock Text="èƒŒæ™¯è‰²" FontSize="11" Foreground="#888888"
                                   FontWeight="SemiBold" Margin="0,0,0,4"/>
                        <!-- ã‚«ãƒ†ã‚´ãƒªé¸æŠžï¼ˆãƒ“ãƒ“ãƒƒãƒ‰ / ãƒŠãƒãƒ¥ãƒ©ãƒ«ï¼‰ -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <RadioButton x:Name="VividCategoryRadio" Content="ãƒ“ãƒ“ãƒƒãƒ‰"
                                         IsChecked="True" GroupName="BgPaletteCategory"
                                         Margin="0,0,12,0" FontSize="11"/>
                            <RadioButton x:Name="NaturalCategoryRadio" Content="ãƒŠãƒãƒ¥ãƒ©ãƒ«"
                                         GroupName="BgPaletteCategory" FontSize="11"/>
                        </StackPanel>
                        <!-- è‰²ã‚°ãƒªãƒƒãƒ‰ï¼ˆã‚³ãƒ¼ãƒ‰ãƒ“ãƒã‚¤ãƒ³ãƒ‰ã§å‹•çš„ç”Ÿæˆï¼‰ -->
                        <UniformGrid x:Name="BgColorGrid" Columns="4" Rows="2"
                                     Margin="0,0,0,8"/>

                        <!-- åŒºåˆ‡ã‚Šç·š -->
                        <Rectangle Height="1" Fill="#DDDDDD" Margin="0,0,0,8"/>

                        <!-- === ä¸é€æ˜Žåº¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ === -->
                        <TextBlock Text="ä¸é€æ˜Žåº¦" FontSize="11" Foreground="#888888"
                                   FontWeight="SemiBold" Margin="0,0,0,4"/>
                        <DockPanel Margin="0,0,0,8">
                            <TextBlock x:Name="OpacityValueText" DockPanel.Dock="Right"
                                       Text="100%" Width="38" TextAlignment="Right"
                                       FontSize="11" VerticalAlignment="Center"/>
                            <Slider x:Name="OpacitySlider"
                                    Minimum="0" Maximum="100" Value="100"
                                    TickFrequency="1" IsSnapToTickEnabled="True"
                                    Focusable="False"/>
                        </DockPanel>

                        <!-- åŒºåˆ‡ã‚Šç·š -->
                        <Rectangle Height="1" Fill="#DDDDDD" Margin="0,0,0,8"/>

                        <!-- === ãƒ•ã‚©ãƒ³ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ === -->
                        <TextBlock Text="ãƒ•ã‚©ãƒ³ãƒˆ" FontSize="11" Foreground="#888888"
                                   FontWeight="SemiBold" Margin="0,0,0,4"/>
                        <ComboBox x:Name="FontFamilyCombo"
                                  Height="26" FontSize="11"
                                  IsEditable="False"/>
                    </StackPanel>
                </Border>
            </Popup>

        </Grid>
    </Border>
</Window>
